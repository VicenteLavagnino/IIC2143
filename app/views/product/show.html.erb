<!DOCTYPE html>
<html>
<head>
    <title>Detalle del Producto</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.css">
    <style>
        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
        }

        .title-with-menu {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dropdown-trigger button {
            border: none;
            background: none;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <section class="section">
        <div class="container">
            <div class="columns">
                <!-- Columna de Información del Producto -->
                <div class="column is-half">
                    <div class="box">
                        <div class="title-with-menu">
                            <h1 class="title is-3"><%= @product.name %></h1>
                            <div class="dropdown is-right is-hoverable">
                                <div class="dropdown-trigger">
                                    <button class="button" aria-haspopup="true" aria-controls="dropdown-menu">
                                        <span>&#x22EE;</span>
                                    </button>
                                </div>
                                <div class="dropdown-menu" id="dropdown-menu" role="menu">
                                    <div class="dropdown-content">
                                        <a href="#" class="dropdown-item" onclick="openModal(); return false;">
                                            Reportar
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box image-container" style="height: 300px;">
                            <%= cl_image_tag(@product.image, class: "product-image") %>
                        </div>
                        <h2 class="subtitle">Subido por: <%= @product.user.name %></h2>
                        <p>Set: <%= @product.set %></p>
                        <p><%= @product.description %></p>
                    </div>
                </div>

                <!-- Columna de Ofertas Disponibles -->
                <div class="column is-half">
                    <div class="box">
                        <h2 class="title">Ofertas</h2>

                        <!-- Botón para Subir Ofertas -->
                        <% if user_signed_in? && current_user != @product.user %>
                            <%= link_to "Subir Oferta", new_product_offer_path(product_id: @product.id), class: "button is-primary" %>
                        <% end %>

                        <!-- Lista de ofertas -->
                        <% @offers.each do |offer| %>
                            <div class="box">
                                <div class="media">
                                    <div class="media-left">
                                        <%= cl_image_tag(offer.image, width: 64, height: 64, crop: "fill", class: "media-object") %>
                                    </div>
                                    <div class="media-content">
                                        <strong><%= offer.name %></strong>
                                        <p><%= offer.description %></p>
                                    </div>
                                    <div class="media-right">
                                        <p>Ofrecido por: <%= offer.user.name %></p>
                                        <p>Estado: <%= offer.state %></p>
                                        <% if user_signed_in? && current_user == @product.user %>
                                            <%= link_to 'Aceptar Oferta', '#', class: 'button is-primary', onclick: "acceptOffer(#{offer.user.id}); return false;" %>
                                        <% end %>
                                        <% if user_signed_in? && current_user == offer.user %>
                                            <%= form_with url: offer_delete_path(offer), method: :delete do %>
                                                <%= submit_tag 'Eliminar Oferta', class: 'button is-danger' %>
                                            <% end %>
                                        <% end %>
                                    </div>
                                </div>
                            </div>
                        <% end %>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script>
        function acceptOffer(userId) {
            alert('Intercambio aceptado, ahora serás redirigido para comunicarte con el ofertador.');
            window.location.href = `/chat/${userId}`;
        }

        function openModal() {
            document.getElementById('reportModal').classList.add('is-active');
        }
  
        function closeModal() {
            document.getElementById('reportModal').classList.remove('is-active');
        }
    </script>
</body>
</html>
