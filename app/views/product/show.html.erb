<!DOCTYPE html>
<html>
<head>
  <title>Detalle del Producto</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.css">
  <style>
    .image-container img {
      width: 100%; 
      height: 100%;
      object-fit: contain; 
      object-position: center;
    }
  </style>
</head>
<body>
  <section class="section">
    <div class="container">
      <div class="columns">

        <!-- Columna de Información del Producto -->
        <div class="column is-half">
          <div class="box">

            <h1 class="title is-3 has-text-centered"><%= @product.name %></h1>

            <div class="box image-container" style="height: 300px;"> <!-- Establece una altura fija para el contenedor de la imagen -->
              <%= cl_image_tag(@product.image, class: "product-image") %>
            </div>

            <h2 class="subtitle">Subido por: <%= @product.user.name %></h2>

            <p>Set: <%= @product.set %></p>

            <p><%= @product.description %></p>
          </div>
        </div>

        <!-- Columna de Ofertas Disponibles -->
<div class="column is-half">
  <div class="box">
    <h2 class="title">Ofertas</h2>
    

    <!-- Botón para Subir Ofertas -->
    
    <% if user_signed_in? && current_user != @product.user %>
        <%= link_to "Subir Oferta", new_product_offer_path(product_id: @product.id), class: "button is-primary" %>
     <% end %>
     <% if !@show_offer_button && user_signed_in? %>
  <div class="notification is-danger">
    Hay una oferta aceptada - Esperando confirmación
  </div>
<% end %>
    <!-- Lista de ofertas -->
    <% @offers.each do |offer| %>
      <div class="box">
        <div class="media">
          <div class="media-left">
            <!-- Imagen de la oferta -->
            <%= cl_image_tag(offer.image, width: 64, height: 64, crop: "fill", class: "media-object") %>
          </div>
          <div class="media-content">
            <!-- Título y descripción de la oferta -->
            <strong><%= offer.name %></strong>
            <p><%= offer.description %></p>
          </div>
          <div class="media-right">
            <!-- Quién ofreció y estado de la oferta -->
            <p>Ofrecido por: <%= offer.user.name %></p>
            <p>Estado: <%= offer.state %></p>
            <% if  @show_offer_button && user_signed_in? && current_user == @product.user %>
                <%= link_to 'Aceptar Oferta', '#', class: 'button is-primary', onclick: "acceptOffer(#{offer.user.id}); return false;" %>
            <% end %>    
            <% if user_signed_in? && current_user == offer.user %>
              <%= form_with url: offer_delete_path(offer), method: :delete do %>
                <%= submit_tag 'Eliminar Oferta', class: 'button is-danger' %>
              <% end %>
            <% end %>
            

          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>


      </div>
    </div>
  </section>
</body>
</html>

<script>
  function acceptOffer(userId) {
    // Muestra una notificación en pantalla
    alert('Intercambio aceptado, ahora serás redirigido para comunicarte con el ofertador.');
    // Redirige al usuario al chat con el ofertador
    window.location.href = `/chat/${userId}`;
  }
</script>
