<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.css">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <style>
        .user-select {
            display: block;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .user-select:hover {
            background-color: #e4e4e4;
            text-decoration: none;
        }
        .message {
    max-width: 60%; /* Limita el ancho del mensaje para que no ocupe todo el ancho del contenedor */
    padding: 10px; /* Espacio interno alrededor del contenido del mensaje */
    margin-bottom: 10px; /* Espacio entre mensajes */
    border-radius: 15px; /* Bordes redondeados para los mensajes */
}

.sent {
    background-color: #DCF8C6; /* Color de fondo para los mensajes enviados */
    margin-left: auto; /* Alinea el mensaje a la derecha */
}

.received {
    background-color: #EDEDED; /* Color de fondo para los mensajes recibidos */
    margin-right: auto; /* Alinea el mensaje a la izquierda */
}
.chat-box {
    display: flex;
    flex-direction: column;
    height: 400px;  /* Puedes ajustar este valor según tus necesidades */
    overflow-y: auto;   /* Añade una barra de desplazamiento cuando el contenido excede el alto máximo */
}
.recipient-name {
    font-weight: bold;
    margin-bottom: 15px;
    text-align: center;
}
/* ... tus otros estilos ... */

.message-input-area {
    width: 100%; 
}

.message-input {
    width: 100%;  /* Asegurándonos de que ocupe todo el ancho disponible */
    border-radius: 4px; /* Bordes redondeados para el textarea */
    padding: 10px; /* Espacio interno para el textarea */
}

.send-button {
    flex-shrink: 0; /* Evita que el botón se reduzca y ocupe menos espacio del asignado */
}




    </style>
</head>

<body>
    <section class="section">
        <div class="container">
            <h1 class="title has-text-centered">Lobby de Mensajería</h1>
            <div class="columns">
                <!-- Columna Izquierda -->
                <div class="column is-one-third">
                    <!-- Lista de Usuarios -->
                    <div class="box">
                        <h3 class="subtitle">Usuarios</h3>
                        <% if @users.present? %>
                            <% @users.each do |user| %>
                                <a class="user-select" href="<%= start_chat_path(user.id) %>">
                                    <p><%= user.name %></p>
                                </a>
                            <% end %>
                        <% else %>
                            <p>Eres el único perfil que existe (literal).</p>
                        <% end %>
                    </div>

                    <!-- Chats disponibles -->
                    <div class="box">
                        <h3 class="subtitle">Mis Chats</h3>
                        <% if @chats&.any? %>
                            <% @chats.each do |chat| %>
                                <% recipient = chat.user1_id == current_user.id ? User.find(chat.user2_id) : User.find(chat.user1_id) %>
                                <p><%= link_to recipient.name, chat_path(chat) %></p>
                            <% end %>
                        <% else %>
                            <p>No tienes chats activos.</p>
                        <% end %>
                    </div>
                </div>

                <!-- Columna Derecha: Chat Abierto -->
                <div class="column is-two-thirds">
                    <div class="box">
                        <% if @recipient %>
                            <h2 class="recipient-name"><%= @recipient.name %></h2>
                        <% end %>

                        <div class="chat-box">
                            <% if @messages&.any? %>        
                                <% previous_user = nil %> 
                                <% @messages.each do |message| %>
                                    <% if message.user == current_user %>
                                        <div class="message sent">
                                            <%= message.content %>
                                        </div>
                                    <% else %>
                                        <div class="message received">
                                            <%= message.content %>
                                        </div>
                                    <% end %>
                                <% end %>
                            <% else %> 
                                <p>CHATEA CON ALGUIEN</p>
                            <% end %>
                        </div>

                        <div class="message-input-area field has-addons">
                            <% if @chat %>
                                <%= form_for [ @chat, @chat.messages.build ] do |f| %>
                                    <div class="control is-expanded">
                                        <%= f.text_area :content, placeholder: 'Escribe tu mensaje aquí...', rows: 4, class: 'textarea message-input' %>
                                    </div>
                                    <div class="control">
                                        <%= f.submit 'Enviar', class: 'button is-primary send-button' %>
                                    </div>
                                <% end %>
                            <% else %>
                                <p>Chat no encontrado.</p>
                            <% end %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- No olvides incluir Font Awesome si quieres usar los íconos -->
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
</body>

</html>
